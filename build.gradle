plugins {
    id 'java'
    id 'org.springframework.boot' version '4.0.0'
    id 'io.spring.dependency-management' version '1.1.7'
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'
description = 'AI-based book review operation service'

java {
    toolchain {
        // 로컬 빌드 환경에서 자동으로 받을 수 있는 안정 LTS 버전으로 지정
        languageVersion = JavaLanguageVersion.of(21)
    }
}

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
    all {
        exclude group: 'org.springframework.boot', module: 'spring-boot-starter-logging'
    }
}

repositories {
    mavenCentral()
}

dependencies {
    // =========================
    // Spring Boot Core & Web
    // =========================
    implementation 'org.springframework.boot:spring-boot-starter-webmvc'
    implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
    implementation 'org.springframework.boot:spring-boot-starter-validation'
    implementation 'org.springframework.boot:spring-boot-starter-log4j2'

    // =========================
    // Persistence (MongoDB)
    // =========================
    implementation 'org.springframework.boot:spring-boot-starter-data-mongodb'

    // =========================
    // Security & OAuth2
    // =========================
    implementation 'org.springframework.boot:spring-boot-starter-security'
    // 기존: spring-boot-starter-security-oauth2-client (존재 X) → 정확한 이름으로 수정
    implementation 'org.springframework.boot:spring-boot-starter-oauth2-client'
    implementation 'org.thymeleaf.extras:thymeleaf-extras-springsecurity6'

    // =========================
    // Monitoring & Actuator
    // =========================
    implementation 'org.springframework.boot:spring-boot-starter-actuator'

    // =========================
    // Google API 연동 (옵션)
    //  - 책 메타데이터/Drive/Docs 연동 등을 고려한 세트
    // =========================
    implementation 'com.google.api-client:google-api-client:1.32.1'
    implementation 'com.google.oauth-client:google-oauth-client:1.36.0'
    implementation 'com.google.oauth-client:google-oauth-client-jetty:1.36.0'
    implementation 'com.google.http-client:google-http-client-gson:1.45.0'
    implementation 'com.google.apis:google-api-services-drive:v3-rev197-1.25.0'
    implementation 'com.google.auth:google-auth-library-oauth2-http:1.29.0'

    // =========================
    // Utility 라이브러리
    // =========================
    // JSON 처리 (Boot Web에도 포함되지만, 명시적으로 추가해두면 버전 관리 용이)
    implementation 'com.fasterxml.jackson.core:jackson-databind'
    // .env 파일 기반 설정 관리
    implementation 'io.github.cdimascio:java-dotenv:5.2.2'
    // HTML 파싱/크롤링 (도서 정보 스크래핑 등에 활용)
    implementation 'org.jsoup:jsoup:1.18.3'
    // 추가 Validation API (starter-validation에 이미 포함되지만, 명시적 사용 가능)
    implementation 'jakarta.validation:jakarta.validation-api:3.1.0'

    // =========================
    // Crypto (옵션: 추가 암호화/서명 등)
    // =========================
    implementation 'org.bouncycastle:bcprov-jdk18on:1.78.1'
    implementation 'org.bouncycastle:bcpkix-jdk18on:1.79'

    // =========================
    // Lombok & Annotation Processor
    // =========================
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'

    // =========================
    // Devtools (개발 편의)
    // =========================
    developmentOnly 'org.springframework.boot:spring-boot-devtools'

    // =========================
    // Test Dependencies
    // =========================
    // Spring Boot 기본 테스트 세트 (JUnit, AssertJ, Mockito 등 포함)
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    // Spring Security 테스트 지원
    testImplementation 'org.springframework.security:spring-security-test'

    // Testcontainers (MongoDB, JUnit 연동)
    testImplementation 'org.springframework.boot:spring-boot-testcontainers'
    testImplementation 'org.testcontainers:junit-jupiter'
    testImplementation 'org.testcontainers:mongodb'

    // JUnit Platform 런처 (IDE/Gradle 연동용)
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}

// Test task 설정 - JUnit 6(Platform) 사용 & 타입 명시로 IDE 경고 해결
test {
    useJUnitPlatform()
}

// JVM 동적 에이전트 로딩 경고 억제 (향후 JDK 기본값 변경 대비)
tasks.withType(JavaExec).configureEach {
    jvmArgs += '-XX:+EnableDynamicAgentLoading'
}

tasks.withType(Test).configureEach {
    jvmArgs += '-XX:+EnableDynamicAgentLoading'
}
